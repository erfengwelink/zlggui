
/**
@author liuxizhen
@data 2013年3月23日9:01:40
@brief  jlx12864驱动

*/

/* Test program for JLX12864G-0086 
   Driver IC is UC1701X(or competible) 
   Programmed by Ken,Dec.24,2010 
   JLX electronic Co.,ltd,    
   http://www.jlxlcd.cn; 
  */ 
// #include <reg51.H> 
//  
// sbit cs1=P1^1; 
// sbit reset=P1^0; 
// sbit rs=P3^0; 
// sbit sclk=P3^1; 
// sbit sid=P3^2;//sid 就是 SDA,串行数据信号 
/*
rst-->PE1
cs-->PD4
rs(Register select)-->PD5
sclk--->PD7
sid-->pd11
*/
//reset=0  RESET_L
//reset=1  RESET_H 
//cs1=0   CS1_L   void GPIO_SetBits(GPIO_TypeDef* GPIOx, uint16_t GPIO_Pin);
//cs1=1  CS1_H 


//rs=0; RS_L
//rs=1;RS_H
//sclk=0;SCK_L
//sclk=1;SCK_H
//sid=0 ;SID_L
//sid=1; SID_H

#include "stdio.h"
#include "..//STM32Lib//stm32f10x_gpio.h"


#define CS1_L 			GPIO_ResetBits(GPIOD, GPIO_Pin_4)		//预置高	 PD11-CS
#define CS1_H				GPIO_SetBits(GPIOD, GPIO_Pin_4)		//预置高	 PD11-CS
#define RESET_L			GPIO_ResetBits(GPIOE, GPIO_Pin_1)
#define RESET_H			GPIO_SetBits(GPIOE, GPIO_Pin_1)
#define RS_L				GPIO_ResetBits(GPIOD, GPIO_Pin_5)
#define RS_H				GPIO_SetBits(GPIOD, GPIO_Pin_5)

#define SCK_L				GPIO_ResetBits(GPIOD, GPIO_Pin_7)
#define SCK_H				GPIO_SetBits(GPIOD, GPIO_Pin_7)
#define SID_L				GPIO_ResetBits(GPIOD, GPIO_Pin_11)
#define SID_H  			GPIO_SetBits(GPIOD, GPIO_Pin_11)

#define KEY_INT   	GPIO_ReadInputDataBit(GPIOB,GPIO_Pin_15)




 
 
void Transfer_data(int data1); 
void Transfer_command(int data1); 
unsigned char graphic1[]; 
 
void Delay(int i); 
void Delay1(int i); 
void DisplayGraphic1(); 
void Initial_Lcd(); 
void clear_screen(); 
void Switch(); 
 
 
 //===============main program=================== 
void LcdDisplay(void) 
 { 
      int i,j,k; 
     Initial_Lcd(); 
      while(1) 
      { 
				clear_screen();    //clear all dots 
        DisplayGraphic1();  //display a picture of 128*64 dots 
        Switch();
				clear_screen();    //clear all dots 
				Delay(50000);
       } 
} 

//============initial 
void Initial_Lcd() 
{ 
      RESET_L;                 //Reset the chip when RESET_L  
      Delay(50); 
      RESET_H; 
      Delay(50);         
   Transfer_command(0xe2);     /*软复位*/ 
   Transfer_command(0x2c);     /*升压步聚 1*/  
   Transfer_command(0x2e);     /*升压步聚 2*/ 
   Transfer_command(0x2f);     /*升压步聚 3*/ 
   Transfer_command(0x23);     /*粗调对比度，可设置范围 20～27*/ 
   Transfer_command(0x81);     /*微调对比度*/ 
   Transfer_command(0x28);     /*微调对比度的值，可设置范围 0～63*/ 
   Transfer_command(0xa2);     /*1/9 偏压比（bias）*/ 
   Transfer_command(0xc8);     /*行扫描顺序：从上到下*/ 
   Transfer_command(0xa0);     /*列扫描顺序：从左到右*/ 
	 //Transfer_command(0xa1);
   Transfer_command(0xaf);     /*开显示*/ 
} 

//===============clear all dot martrics============= 
void clear_screen() 
{ 
unsigned char i,j; 
    for(i=0;i<9;i++) 
    { 
      CS1_L; 
      Transfer_command(0xb0+i); 
      Transfer_command(0x10); 
			Transfer_command(0x00); 
      for(j=0;j<132;j++) 
      { 
             Transfer_data(0x00); 
      } 
    } 
} 
 
 
//==================display a piture of 128*64 dots================ 
void DisplayGraphic1() 
{ 
    unsigned char  *address;    //define pointer 
    int i,j; 
    address=graphic1;   //data pointer:point to "graphic[]",one-dimensional array 
    for(i=0;i<8;i++) 
    { 
       CS1_L; 
      Transfer_command(0xb0+i);   //set page address, 
//      Transfer_command(0x10); 
//      Transfer_command(0x00); 
      for(j=0;j<128;j++) 
      { 
          Transfer_command((0x10)|(j>>4));//刘西振这两行是控制列地址的。
				  Transfer_command((0x00)|(j&0x0f));//
					Transfer_data(*address);     
          address++;        
      } 
    } 
}

//==================display a piture of 128*64 dots================ 
void FullAll(unsigned char dat) 
{ 
    int i,j; 
    for(i=0;i<8;i++) 
    { 
       CS1_L; 
      Transfer_command(0xb0+i);   //set page address, 
//      Transfer_command(0x10); 
//      Transfer_command(0x00); 
      for(j=0;j<128;j++) 
      { 
          Transfer_command((0x10)|(j>>4));//刘西振这两行是控制列地址的。
				  Transfer_command((0x00)|(j&0x0f));//
					Transfer_data(dat);            
      } 
    } 
}


/*=======写指令========*/ 
void Transfer_command(int data1)    
{ 
   char i; 
   CS1_L; 
   RS_L; 
   for(i=0;i<8;i++) 
   { 
      SCK_L; 
      if(data1&0x80) SID_H; 
      else SID_L; 
      Delay1(2); 
      SCK_H; 
      Delay1(2); 
      data1=data1<<=1; 
    } 
} 


/*--------写数据------------*/ 
void Transfer_data(int data1) 
{ 
   char i; 
   CS1_L; 
   RS_H; 
   for(i=0;i<8;i++) 
   { 
      SCK_L; 
      if(data1&0x80) SID_H; 
      else SID_L; 
      SCK_H; 
      data1=data1<<=1; 
    } 
} 
 
/*=========延时=====================*/ 
void Delay(int i)                
{ 
 int j,k; 
 for(j=0;j<i;j++) 
 //for(k=0;k<990;k++); 
	for(k=0;k<800;k++); 
} 
 
/*=========延时=====================*/ 
void Delay1(int i) 
{ 
 int j,k; 
 for(j=0;j<i;j++) 
 for(k=0;k<1;k++); 
} 

/*=========等按键=====================*/ 
void Switch() 
{ 
 repeat: 
//    if (KEY_INT) goto repeat; 

	while(KEY_INT){
		Delay(5);
	}
	// else Delay(1); 
	
//   if (KEY_INT&0x01) goto repeat; 
//   else; 
} 
//-------------------------------------------- 
 
unsigned char graphic1[]={ 
/*--  调入了一幅图像：d:\My Documents\My Pictures\多字.bmp  --*/ 


/*--  宽度 x 高度=128x64  --*/ 
0x00,0x00,0x00,0x00,0x7E,0x2A,0x2A,0x2A,0x2A,0x2A,0x2A,0x7E,0x00,0x00,0x00,0x00, 
0x02,0xFE,0x92,0x92,0x92,0xFE,0x12,0x11,0x12,0x1C,0xF0,0x18,0x17,0x12,0x10,0x00, 
0x20,0x21,0x2E,0xE4,0x00,0x42,0x42,0xFE,0x42,0x42,0x42,0x02,0xFE,0x00,0x00,0x00, 
0x00,0x00,0xF8,0x48,0x48,0x48,0x48,0xFF,0x48,0x48,0x48,0x48,0xF8,0x00,0x00,0x00, 
0x00,0x00,0x02,0x02,0x02,0x02,0x02,0xE2,0x12,0x0A,0x06,0x02,0x00,0x80,0x00,0x00, 
0x00,0x08,0x08,0x08,0xFF,0x08,0x08,0xF8,0x00,0xF8,0x08,0x08,0x08,0xF8,0x00,0x00, 
0x00,0x00,0x02,0x02,0x02,0x02,0x02,0xFE,0x02,0x02,0x02,0x02,0x02,0x02,0x00,0x00, 
0x00,0x00,0xFE,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x00, 
0x00,0x7F,0x25,0x25,0x25,0x25,0x7F,0x00,0x00,0x7F,0x25,0x25,0x25,0x25,0x7F,0x00, 
0x08,0x1F,0x08,0x08,0x04,0xFF,0x05,0x81,0x41,0x31,0x0F,0x11,0x21,0xC1,0x41,0x00, 
0x00,0x00,0x00,0x7F,0x20,0x10,0x00,0x7F,0x00,0x00,0x00,0x00,0x3F,0x40,0x38,0x00, 
0x00,0x00,0x0F,0x04,0x04,0x04,0x04,0x3F,0x44,0x44,0x44,0x44,0x4F,0x40,0x70,0x00, 
0x01,0x01,0x01,0x01,0x01,0x41,0x81,0x7F,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00, 
0x40,0x20,0x18,0x07,0x00,0x20,0x40,0x3F,0x00,0x7F,0x10,0x10,0x10,0x3F,0x00,0x00, 
0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3F,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00, 
0x40,0x30,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 
0x10,0x61,0x06,0xE0,0x18,0x84,0xE4,0x1C,0x84,0x65,0xBE,0x24,0xA4,0x64,0x04,0x00, 
0x00,0x00,0x00,0x00,0x7E,0x2A,0x2A,0x2A,0x2A,0x2A,0x2A,0x7E,0x00,0x00,0x00,0x00, 
0x00,0x00,0xFF,0x09,0x49,0x59,0xE9,0x49,0x49,0x49,0xE9,0x59,0x49,0x4F,0x00,0x00, 
0x10,0x61,0x06,0xE0,0x18,0x84,0xE4,0x1C,0x84,0x65,0xBE,0x24,0xA4,0x64,0x04,0x00, 
0x00,0x00,0x00,0x00,0x7E,0x2A,0x2A,0x2A,0x2A,0x2A,0x2A,0x7E,0x00,0x00,0x00,0x00, 
0x00,0x00,0x00,0x3E,0x2A,0xEA,0x2A,0x2A,0x2A,0xEA,0x2A,0x3E,0x00,0x00,0x00,0x00, 
0x00,0x20,0x20,0x22,0x22,0x22,0x22,0xE2,0x22,0x22,0x22,0x22,0x22,0x20,0x20,0x00, 
0x40,0x40,0x4F,0x49,0x49,0xC9,0xCF,0x70,0xC0,0xCF,0x49,0x59,0x69,0x4F,0x00,0x00, 
0x04,0x04,0xFF,0x00,0x01,0x00,0xFF,0x41,0x21,0x12,0x0C,0x1B,0x61,0xC0,0x40,0x00, 
0x00,0x7F,0x25,0x25,0x25,0x25,0x7F,0x00,0x00,0x7F,0x25,0x25,0x25,0x25,0x7F,0x00, 
0x40,0x30,0x0F,0x82,0x42,0x32,0x0F,0x02,0x02,0x02,0xFF,0x02,0x02,0x02,0x02,0x00, 
0x04,0x04,0xFF,0x00,0x01,0x00,0xFF,0x41,0x21,0x12,0x0C,0x1B,0x61,0xC0,0x40,0x00, 
0x00,0x7F,0x25,0x25,0x25,0x25,0x7F,0x00,0x00,0x7F,0x25,0x25,0x25,0x25,0x7F,0x00, 
0x20,0x21,0x22,0x2C,0x20,0x3F,0x20,0x20,0x20,0x3F,0x28,0x24,0x23,0x20,0x20,0x00, 
0x10,0x08,0x04,0x03,0x00,0x40,0x80,0x7F,0x00,0x00,0x01,0x02,0x0C,0x18,0x00,0x00, 
0x02,0x02,0x7E,0x45,0x45,0x44,0x7C,0x00,0x7C,0x44,0x45,0x45,0x7E,0x06,0x02,0x00, 
0x00,0x80,0x40,0x60,0x50,0x48,0x44,0xC3,0x44,0x48,0x50,0x70,0x60,0x20,0x00,0x00, 
0x40,0x44,0x24,0x24,0xF4,0x5C,0x57,0x54,0x54,0x5C,0x54,0x24,0x64,0xC4,0x44,0x00, 
0x00,0x00,0xFF,0x91,0x91,0xFF,0x00,0x00,0xFF,0xC1,0x41,0x49,0x51,0xCF,0x00,0x00, 
0x20,0x10,0x10,0x88,0x84,0x4F,0x52,0xA2,0x22,0x52,0x4A,0x86,0x80,0x80,0x80,0x00, 
0x08,0xF4,0x57,0x54,0xFC,0x54,0xF0,0x42,0xA2,0x1E,0x02,0xA2,0x62,0x3E,0x00,0x00, 
0x02,0x04,0xD8,0x08,0x00,0x08,0x08,0x08,0xFF,0x08,0x08,0x08,0xF8,0x00,0x00,0x00, 
0x08,0x08,0x08,0x08,0x08,0x08,0xF9,0x4A,0x4C,0x48,0x48,0xC8,0x08,0x08,0x08,0x00, 
0x00,0x20,0x2C,0x24,0x64,0x74,0xAD,0xA6,0xE4,0x34,0x24,0x24,0x2C,0x24,0x00,0x00, 
0x00,0x40,0x40,0x44,0x44,0x44,0x44,0x7F,0x44,0x44,0x44,0x46,0x44,0x60,0x40,0x00, 
0x04,0x04,0x44,0x64,0x57,0x4D,0x45,0x65,0x25,0x25,0x35,0xE4,0x44,0x04,0x04,0x00, 
0x40,0x30,0x0F,0x20,0x40,0x3F,0x00,0x00,0x7F,0x21,0x16,0x08,0x36,0x61,0x20,0x00, 
0x80,0x81,0x41,0x42,0x22,0x12,0x0E,0x03,0x02,0x42,0x82,0x7E,0x00,0x01,0x00,0x00, 
0x80,0x7F,0x02,0x02,0x5F,0x82,0x7F,0x0A,0x09,0x09,0x09,0xFF,0x09,0x09,0x09,0x00, 
0x02,0xFE,0x01,0x80,0x41,0x21,0x11,0x0D,0x03,0x05,0x09,0x11,0x31,0x61,0x21,0x00, 
0x40,0x40,0x20,0x10,0x0C,0x03,0x00,0x00,0x20,0x40,0x40,0x3F,0x00,0x00,0x00,0x00, 
0x00,0x24,0x24,0x25,0x15,0x15,0x0D,0xFE,0x04,0x0D,0x17,0x14,0x24,0x64,0x24,0x00, 
0x88,0xC8,0xB8,0x8F,0xE8,0x88,0x88,0x20,0x1C,0x0B,0xE8,0x08,0x08,0x18,0x08,0x00, 
0x40,0x20,0xF8,0x0F,0x82,0x60,0x1E,0x14,0x10,0xFF,0x10,0x10,0x10,0x10,0x00,0x00, 
0x02,0xC2,0xF2,0x4E,0x42,0xC2,0x00,0xFA,0x4A,0x4A,0xFE,0x4A,0x4A,0xFA,0x02,0x00, 
0x40,0x20,0xF8,0x0F,0x82,0x60,0x1E,0x14,0x10,0xFF,0x10,0x10,0x10,0x10,0x00,0x00, 
0x00,0x44,0x44,0x54,0x55,0xFE,0x54,0x54,0x54,0xFE,0x55,0x54,0xF4,0x44,0x40,0x00, 
0x00,0xFE,0x02,0xF2,0x12,0x12,0xF2,0x00,0xF2,0x12,0x1A,0xD6,0x12,0xF2,0x02,0x00, 
0x00,0x00,0xFF,0x91,0x91,0xFF,0x00,0x00,0xFF,0xC1,0x41,0x49,0x51,0xCF,0x00,0x00, 
0x20,0x10,0x10,0x88,0x84,0x4F,0x52,0xA2,0x22,0x52,0x4A,0x86,0x80,0x80,0x80,0x00, 
0x08,0x08,0x08,0x08,0xFF,0x04,0x84,0x60,0x18,0x06,0x01,0x06,0x18,0xE0,0x40,0x00, 
0x00,0x00,0xFF,0x00,0x01,0x01,0x01,0x01,0x01,0xFF,0x01,0x01,0x01,0x01,0x01,0x00, 
0x01,0x00,0x3F,0x88,0x88,0x5F,0x44,0x2B,0x12,0x1E,0x23,0x22,0x42,0xC3,0x40,0x00, 
0x00,0x00,0xFF,0x00,0x01,0x01,0x01,0x01,0x01,0xFF,0x01,0x01,0x01,0x01,0x01,0x00, 
0x40,0x20,0x11,0x09,0x07,0xFF,0x01,0x01,0x01,0xFF,0x05,0x09,0x33,0x60,0x20,0x00, 
0x20,0x1F,0x00,0x3F,0x10,0x09,0x45,0x40,0x2F,0x20,0x10,0x0F,0x10,0x2F,0x60,0x00, 
0x40,0x30,0x0F,0x20,0x40,0x3F,0x00,0x00,0x7F,0x21,0x16,0x08,0x36,0x61,0x20,0x00, 
0x80,0x81,0x41,0x42,0x22,0x12,0x0E,0x03,0x02,0x42,0x82,0x7E,0x00,0x01,0x00,0x00 
 
}; 



/*****************************************************************************/







